---
output:
  html_document: default
  pdf_document: default
---
```{r include=FALSE}
pacman::p_load(dplyr,sjmisc,car,sjlabelled,labelled,stargazer,kableExtra,corrplot,sessioninfo,readxl,
               pander,xtable,tidyverse,extrafont,ggplot2,forcats,ggpubr,naniar,haven,devtools,
               summarytools,poLCA,sjPlot,lavaan,knitr,summarytools,psych,semTable,texreg,pandoc)
table_format = if(is_html_output()) {
  "html"
} else if(is_latex_output()) {
  "latex"
}

table_format2 = if(is_html_output()) {
  T
} else if(is_latex_output()) {
  F
}
fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #supress loadings
  loadings[loadings < cut] <- ""
  #get additional info
  add_info <- cbind(x$communality, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(across(where(is.numeric), round, 3))
}
```
```{r include=FALSE}
#remotes::install_github('rstudio/bookdown')
load("Input/Data_proc/data.RData") # Data
load("Output/Tablas/m2_4.fit.RData")
load("Output/Tablas/m3_3.fit.RData")
load("Output/Tablas/msf_3.fit.RData")
load("Output/Tablas/m_merit.4_ord.fit.RData")
load("Output/Tablas/m4_rmsea_adj.fit.RData")

# Variable dependiente

data %>% 
  dplyr::select(atrib_pob_1,atrib_pob_2,atrib_pob_3,atrib_pob_4,atrib_pob_5,
                atrib_riq_1,atrib_riq_2,atrib_riq_3,atrib_riq_4,atrib_riq_5) -> atribcor

data %>% 
  dplyr::select(merit_perc_effort,merit_perc_talent,merit_perc_wpart,merit_perc_netw, 
                merit_pref_effort,merit_pref_talent,merit_pref_wpart,merit_pref_netw) -> meritcor

dep_fa1 <- data %>% dplyr::select(atrib_pob_1,atrib_pob_2,atrib_pob_3,atrib_pob_4,atrib_pob_5,
                            atrib_riq_1,atrib_riq_2,atrib_riq_3,atrib_riq_4,atrib_riq_5) # Con variables fatalistas

dep_fa2 <- data %>% dplyr::select(atrib_pob_1,atrib_pob_3,atrib_pob_4,atrib_pob_5,
                                 atrib_riq_1,atrib_riq_3,atrib_riq_4,atrib_riq_5) # Sin variables fatalistas


cor_dep_fa1 =cor(dep_fa1, use = "complete.obs")
cor_dep_fa2 =cor(dep_fa2, use = "complete.obs")

# EFA 2 factores 
fa_pa.2_fatal<- fa(r=dep_fa1, nfactors = 2, rotate = "oblimin", fm="pa")
colnames(fa_pa.2_fatal$loadings) <- c("Atribuciones Internas", "Atribuciones Externas")

f2_table <- fa_table(fa_pa.2_fatal, -10)
rownames(f2_table)  <- c("Atribuciones riqueza Talento","Atribuciones pobreza Falta esfuerzo","Atribuciones riqueza Trabajo duro","Atribuciones pobreza Falta habilidad","Atribuciones pobreza Mala suerte","Atribuciones riqueza Suerte","Atribuciones pobreza Sistema económico","Atribuciones pobreza Sistema educativo","Atribuciones riqueza Sistema económico","Atribuciones riqueza Sistema educativo")
f2_table <- dplyr::select(f2_table, -item)

# EFA 3 factores
fa_pa.3<- fa(r=dep_fa1, nfactors = 3, rotate = "oblimin", fm="pa")
colnames(fa_pa.3$loadings) <- c("Atribuciones Internas", "Atribuciones Externas", "Atribuciones Fatalistas")

f3_table <- fa_table(fa_pa.3, -10)
rownames(f3_table)  <- c("Atribuciones riqueza Trabajo duro","Atribuciones riqueza Talento","Atribuciones pobreza Falta esfuerzo","Atribuciones pobreza Falta habilidad","Atribuciones pobreza Sistema económico","Atribuciones pobreza Sistema educativo","Atribuciones riqueza Sistema económico","Atribuciones riqueza Sistema educativo","Atribuciones pobreza Mala suerte","Atribuciones riqueza Suerte")
f3_table <- dplyr::select(f3_table, -item)



# Variable independiente

merit_fa =cor(meritcor, use = "complete.obs")
merit_fa<-as.data.frame(merit_fa)

# EFA 3 factores

fa_merit_pa.3<- fa(r=merit_fa, nfactors = 3, rotate = "oblimin", fm="pa")
colnames(fa_merit_pa.3$loadings) <- c("Percepción+Preferencias meritocráticas", "Percepción No meritocráticas", "Preferencias No meritocráticas")

# EFA 4 factores 
fa_merit_pa.4<- fa(r=merit_fa, nfactors = 4, rotate = "oblimin", fm="pa", max.iter = 500)
colnames(fa_merit_pa.4$loadings) <- c("Percepción meritocráticas", "Preferencias meritocráticas","Percepción No meritocráticas", "Preferencias No meritocráticas")




ajuste <- c("<b>&#88&sup2<b>","<b>gl<b>","<b>CFI<b>","<b>RMSEA<b>","<b>Num. obs.<b>")

# Structural Regression Model

################################ Modelo 1 (variables objetivas) ###################################

m.obj <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado
Atribuciones_Externas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado
'
fit_m.obj <- sem(m.obj, data=data,ordered = T)
#semoutput::sem_paths(fit_m.obj, standardized = TRUE)

#x <-  parameterEstimates(fit_m.obj) #Para saber la posición de las filas
#options(max.print=999999)
#x
int.obj <- as.data.frame(parameterEstimates(fit_m.obj)[9:22,  ])
ext.obj <- as.data.frame(parameterEstimates(fit_m.obj)[23:36,  ])
fit.messem.inc <- fitMeasures(fit_m.obj,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.obj <- texreg::createTexreg(coef.names  = int.obj$rhs ,
                                coef = int.obj$est,
                                se = int.obj$z,
                                pvalues = int.obj$pvalue,
                                gof = c(fitmeasures(fit_m.obj)[[c(3)]],
                                        fitmeasures(fit_m.obj)[[c(4)]],
                                        fitmeasures(fit_m.obj)[[c(18)]],
                                        fitmeasures(fit_m.obj)[[c(36)]],
                                        nobs(fit_m.obj)),
                                gof.names = ajuste,
                                gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.obj <- texreg::createTexreg(coef.names  = ext.obj$rhs ,
                                  coef = ext.obj$est,
                                  se = ext.obj$z,
                                  pvalues = ext.obj$pvalue,
                                  gof = c(fitmeasures(fit_m.obj)[[c(3)]],
                                          fitmeasures(fit_m.obj)[[c(4)]],
                                          fitmeasures(fit_m.obj)[[c(18)]],
                                          fitmeasures(fit_m.obj)[[c(36)]],
                                          nobs(fit_m.obj)),
                                  gof.names = ajuste,
                                  gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))


################################ Modelo 2 (variable subjetiva) ###################################

m.subj <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ ess_ind 
Atribuciones_Externas ~ ess_ind
'
fit_m.subj <- sem(m.subj, data=data,ordered = T)
#semoutput::sem_paths(fit_m.subj, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_m.subj) #Para saber la posición de las filas
#x
int.subj <- as.data.frame(parameterEstimates(fit_m.subj)[9,  ])
ext.subj <- as.data.frame(parameterEstimates(fit_m.subj)[10,  ])
fit.messem.inc <- fitMeasures(fit_m.subj,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.subj <- texreg::createTexreg(coef.names  = int.subj$rhs ,
                                  coef = int.subj$est,
                                  se = int.subj$z,
                                  pvalues = int.subj$pvalue,
                                  gof = c(fitmeasures(fit_m.subj)[[c(3)]],
                                          fitmeasures(fit_m.subj)[[c(4)]],
                                          fitmeasures(fit_m.subj)[[c(18)]],
                                          fitmeasures(fit_m.subj)[[c(36)]],
                                          nobs(fit_m.subj)),
                                  gof.names = ajuste,
                                  gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.subj <- texreg::createTexreg(coef.names  = ext.subj$rhs ,
                                   coef = ext.subj$est,
                                   se = ext.subj$z,
                                   pvalues = ext.subj$pvalue,
                                   gof = c(fitmeasures(fit_m.subj)[[c(3)]],
                                           fitmeasures(fit_m.subj)[[c(4)]],
                                           fitmeasures(fit_m.subj)[[c(18)]],
                                           fitmeasures(fit_m.subj)[[c(36)]],
                                           nobs(fit_m.subj)),
                                   gof.names = ajuste,
                                   gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

############################# Modelo 3 (variables objetivas y subjetiva) ##############################

m.obj.subj <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado 
+ ess_ind
Atribuciones_Externas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado
+ ess_ind
'
fit_m.obj.subj <- sem(m.obj.subj, data=data,ordered = T)
#semoutput::sem_paths(fit_m.obj.subj, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_m.obj.subj) #Para saber la posición de las filas
#x
int.obj.subj <- as.data.frame(parameterEstimates(fit_m.obj.subj)[9:23,  ])
ext.obj.subj <- as.data.frame(parameterEstimates(fit_m.obj.subj)[24:38,  ])
fit.messem.inc <- fitMeasures(fit_m.subj,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.obj.subj <- texreg::createTexreg(coef.names  = int.obj.subj$rhs ,
                                   coef = int.obj.subj$est,
                                   se = int.obj.subj$z,
                                   pvalues = int.obj.subj$pvalue,
                                   gof = c(fitmeasures(fit_m.obj.subj)[[c(3)]],
                                           fitmeasures(fit_m.obj.subj)[[c(4)]],
                                           fitmeasures(fit_m.obj.subj)[[c(18)]],
                                           fitmeasures(fit_m.obj.subj)[[c(36)]],
                                           nobs(fit_m.subj)),
                                   gof.names = ajuste,
                                   gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.obj.subj <- texreg::createTexreg(coef.names  = ext.obj.subj$rhs ,
                                       coef = ext.obj.subj$est,
                                       se = ext.obj.subj$z,
                                       pvalues = ext.obj.subj$pvalue,
                                       gof = c(fitmeasures(fit_m.obj.subj)[[c(3)]],
                                               fitmeasures(fit_m.obj.subj)[[c(4)]],
                                               fitmeasures(fit_m.obj.subj)[[c(18)]],
                                               fitmeasures(fit_m.obj.subj)[[c(36)]],
                                               nobs(fit_m.subj)),
                                       gof.names = ajuste,
                                       gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

################################ Modelo 4 (variables meritocráticas) ###################################


m.merit <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

## Exogenous factors
perc_merit=~merit_perc_effort+merit_perc_talent
pref_merit=~merit_pref_talent+merit_pref_effort
perc_nmerit=~merit_perc_wpart+merit_perc_netw
pref_nmerit=~merit_pref_netw+merit_pref_wpart

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ perc_merit + pref_merit 
Atribuciones_Externas ~ perc_merit + pref_merit 
'
fit_m.merit <- sem(m.merit, data=data,ordered = T)
#semoutput::sem_paths(fit_m.merit, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_m.merit) #Para saber la posición de las filas
#x
int.merit <- as.data.frame(parameterEstimates(fit_m.merit)[17:18,  ])
ext.merit <- as.data.frame(parameterEstimates(fit_m.merit)[19:20,  ])
fit.messem.inc <- fitMeasures(fit_m.merit,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.merit <- texreg::createTexreg(coef.names  = int.merit$rhs ,
                                       coef = int.merit$est,
                                       se = int.merit$z,
                                       pvalues = int.merit$pvalue,
                                       gof = c(fitmeasures(fit_m.merit)[[c(3)]],
                                               fitmeasures(fit_m.merit)[[c(4)]],
                                               fitmeasures(fit_m.merit)[[c(18)]],
                                               fitmeasures(fit_m.merit)[[c(36)]],
                                               nobs(fit_m.merit)),
                                       gof.names = ajuste,
                                       gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.merit <- texreg::createTexreg(coef.names  = ext.merit$rhs ,
                                    coef = ext.merit$est,
                                    se = ext.merit$z,
                                    pvalues = ext.merit$pvalue,
                                    gof = c(fitmeasures(fit_m.merit)[[c(3)]],
                                            fitmeasures(fit_m.merit)[[c(4)]],
                                            fitmeasures(fit_m.merit)[[c(18)]],
                                            fitmeasures(fit_m.merit)[[c(36)]],
                                            nobs(fit_m.merit)),
                                    gof.names = ajuste,
                                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
################################ Modelo 5 (variables no meritocráticas) ###################################


m.nmerit <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

## Exogenous factors
perc_merit=~merit_perc_effort+merit_perc_talent
pref_merit=~merit_pref_talent+merit_pref_effort
perc_nmerit=~merit_perc_wpart+merit_perc_netw
pref_nmerit=~merit_pref_netw+merit_pref_wpart

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ perc_nmerit + pref_nmerit
Atribuciones_Externas ~ perc_nmerit + pref_nmerit
'
fit_m.nmerit <- sem(m.nmerit, data=data,ordered = T)
#semoutput::sem_paths(fit_m.nmerit, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_m.nmerit) #Para saber la posición de las filas
#x
int.nmerit <- as.data.frame(parameterEstimates(fit_m.nmerit)[17:18,  ])
ext.nmerit <- as.data.frame(parameterEstimates(fit_m.nmerit)[19:20,  ])
fit.messem.inc <- fitMeasures(fit_m.nmerit,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.nmerit <- texreg::createTexreg(coef.names  = int.nmerit$rhs ,
                                    coef = int.nmerit$est,
                                    se = int.nmerit$z,
                                    pvalues = int.nmerit$pvalue,
                                    gof = c(fitmeasures(fit_m.nmerit)[[c(3)]],
                                            fitmeasures(fit_m.nmerit)[[c(4)]],
                                            fitmeasures(fit_m.nmerit)[[c(18)]],
                                            fitmeasures(fit_m.nmerit)[[c(36)]],
                                            nobs(fit_m.nmerit)),
                                    gof.names = ajuste,
                                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.nmerit <- texreg::createTexreg(coef.names  = ext.nmerit$rhs ,
                                     coef = ext.nmerit$est,
                                     se = ext.nmerit$z,
                                     pvalues = ext.nmerit$pvalue,
                                     gof = c(fitmeasures(fit_m.nmerit)[[c(3)]],
                                             fitmeasures(fit_m.nmerit)[[c(4)]],
                                             fitmeasures(fit_m.nmerit)[[c(18)]],
                                             fitmeasures(fit_m.nmerit)[[c(36)]],
                                             nobs(fit_m.nmerit)),
                                     gof.names = ajuste,
                                     gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

###################### Modelo 6 (variables meritocráticas y no meritocráticas) #########################


m.merit.nmerit <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

## Exogenous factors
perc_merit=~merit_perc_effort+merit_perc_talent
pref_merit=~merit_pref_talent+merit_pref_effort
perc_nmerit=~merit_perc_wpart+merit_perc_netw
pref_nmerit=~merit_pref_netw+merit_pref_wpart

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ perc_merit + pref_merit + perc_nmerit + pref_nmerit
Atribuciones_Externas ~ perc_merit + pref_merit + perc_nmerit + pref_nmerit
'
fit_m.merit.nmerit <- sem(m.merit.nmerit, data=data,ordered = T)
#semoutput::sem_paths(fit_m.merit.nmerit, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_m.merit.nmerit) #Para saber la posición de las filas
#x
int.merit.nmerit <- as.data.frame(parameterEstimates(fit_m.merit.nmerit)[17:20,  ])
ext.merit.nmerit <- as.data.frame(parameterEstimates(fit_m.merit.nmerit)[21:24,  ])
fit.messem.inc <- fitMeasures(fit_m.merit.nmerit,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.merit.nmerit <- texreg::createTexreg(coef.names  = int.merit.nmerit$rhs ,
                                     coef = int.merit.nmerit$est,
                                     se = int.merit.nmerit$z,
                                     pvalues = int.merit.nmerit$pvalue,
                                     gof = c(fitmeasures(fit_m.merit.nmerit)[[c(3)]],
                                             fitmeasures(fit_m.merit.nmerit)[[c(4)]],
                                             fitmeasures(fit_m.merit.nmerit)[[c(18)]],
                                             fitmeasures(fit_m.merit.nmerit)[[c(36)]],
                                             nobs(fit_m.merit.nmerit)),
                                     gof.names = ajuste,
                                     gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.merit.nmerit <- texreg::createTexreg(coef.names  = ext.merit.nmerit$rhs ,
                                           coef = ext.merit.nmerit$est,
                                           se = ext.merit.nmerit$z,
                                           pvalues = ext.merit.nmerit$pvalue,
                                           gof = c(fitmeasures(fit_m.merit.nmerit)[[c(3)]],
                                                   fitmeasures(fit_m.merit.nmerit)[[c(4)]],
                                                   fitmeasures(fit_m.merit.nmerit)[[c(18)]],
                                                   fitmeasures(fit_m.merit.nmerit)[[c(36)]],
                                                   nobs(fit_m.merit.nmerit)),
                                           gof.names = ajuste,
                                           gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))


############################ Modelo 7 (todas las variables) #############################


m.total <- '
# measurement model
## Endogenous factors 
Atribuciones_Internas=~atrib_pob_1+atrib_pob_3+atrib_riq_1+atrib_riq_3
Atribuciones_Externas=~atrib_pob_4+atrib_pob_5+atrib_riq_4

## Exogenous factors
perc_merit=~merit_perc_effort+merit_perc_talent
pref_merit=~merit_pref_talent+merit_pref_effort
perc_nmerit=~merit_perc_wpart+merit_perc_netw
pref_nmerit=~merit_pref_netw+merit_pref_wpart

# Cov
atrib_riq_1 ~~ atrib_riq_3

# regressions

Atribuciones_Internas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado
+ ess_ind + 
perc_merit + pref_merit + perc_nmerit + pref_nmerit
Atribuciones_Externas ~ sexo + edad + educ_tecnica + educ_uni_incomp + educ_uni_post + 
ingresos_1 + ingresos_2 + ingresos_3 + ingresos_4 +
act_prin_no_remunerado + act_prin_desempleado + act_prin_trabaja_estudia + act_prin_estudia + act_prin_jubliado
+ ess_ind + 
perc_merit + pref_merit + perc_nmerit + pref_nmerit
'

fit_total <- sem(m.total, data=data,ordered = T)
#summary(fit_total,fit.measures=TRUE,standardized=TRUE,rsquare=T)
#semoutput::sem_paths(fit_total, standardized = TRUE, ci = "standardized")
#x <-  parameterEstimates(fit_total) #Para saber la posición de las filas
#x
int.total <- as.data.frame(parameterEstimates(fit_total)[17:35,  ])
ext.total <- as.data.frame(parameterEstimates(fit_total)[36:54,  ])
fit.messem.inc <- fitMeasures(fit_total,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m.int.total <- texreg::createTexreg(coef.names  = int.total$rhs ,
                                           coef = int.total$est,
                                           se = int.total$z,
                                           pvalues = int.total$pvalue,
                                           gof = c(fitmeasures(fit_total)[[c(3)]],
                                                   fitmeasures(fit_total)[[c(4)]],
                                                   fitmeasures(fit_total)[[c(18)]],
                                                   fitmeasures(fit_total)[[c(36)]],
                                                   nobs(fit_total)),
                                           gof.names = ajuste,
                                           gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m.ext.total <- texreg::createTexreg(coef.names  = ext.total$rhs ,
                                    coef = ext.total$est,
                                    se = ext.total$z,
                                    pvalues = ext.total$pvalue,
                                    gof = c(fitmeasures(fit_total)[[c(3)]],
                                            fitmeasures(fit_total)[[c(4)]],
                                            fitmeasures(fit_total)[[c(18)]],
                                            fitmeasures(fit_total)[[c(36)]],
                                            nobs(fit_total)),
                                    gof.names = ajuste,
                                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))


# ---- Tabla de todos los modelos

## Atribuciones internas

modelos.int1 <- list(m.int.obj,m.int.obj.subj,m.int.merit,m.int.merit.nmerit,m.int.total)
coefm.int1 <- c("Sexo (Ref=hombre)",
            "Edad",
            "Educaci&oacuten t&eacutecnica",
            "Educaci&oacuten universitaria incompleta",
            "Educaci&oacuten universitaria y postgrado",
            "De $358.001 a $448.000",
            "De $448.001 a $1.000.000",
            "De $1.000.001 a $2.000.000",
            "M&aacutes de $2.000.001",
            "No remunerada",
            "Desempleado",
            "Trabaja y estudia",
            "Estudia",
            "Jubliado",
            "Estatus Social Subjetivo",
            "Percepci&oacuten meritocr&aacutetica",
            "Preferencia meritocr&aacutetica",
            "Percepci&oacuten no meritocr&aacutetica",
            "Preferencia no meritocr&aacutetica")
refm.int1 <- list("<b>Educaci&oacuten (ref: Media completa o menos)<b>" = 3:5 ,
              "<b>Rango ingresos mensuales hogar (ref: $358.000 o menos )<b>"= 6:9,
              "<b>Actividad principal (ref: Trabajo jornada completa o parcial)<b>"=10:14)
semINT <- texreg::htmlreg(modelos.int1, center = TRUE,
                 custom.coef.names = coefm.int1,
                 custom.model.names = c("Modelo 1","Modelo 2","Modelo 3","Modelo 4","Modelo 5"),
                 dcolumn = TRUE,
                 booktabs = TRUE,
                 use.packages = FALSE,
                 single.row = FALSE,digits = 3,
                 sideways = FALSE,
                 no.margin = FALSE,scalebox = 0.65,
                 caption.above = TRUE,
#                 custom.note = nota3,
                 float.pos = "H",
                 groups = refm.int1,
                 label = "table:semREC",
#                 omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
                 caption = "Modelos de ecuaciones estructurales para variables independientes con la variable latente <b>Atribuciones internas (1)<b>")#, file='Output/models.html')

## Atribuciones externas


modelos.ext1 <- list(m.ext.obj,m.ext.obj.subj,m.ext.merit,m.ext.merit.nmerit,m.ext.total)
coefm.ext1 <- c("Sexo (Ref=hombre)",
            "Edad",
            "Educaci&oacuten t&eacutecnica",
            "Educaci&oacuten universitaria incompleta",
            "Educaci&oacuten universitaria y postgrado",
            "De $358.001 a $448.000",
            "De $448.001 a $1.000.000",
            "De $1.000.001 a $2.000.000",
            "M&aacutes de $2.000.001",
            "No remunerada",
            "Desempleado",
            "Trabaja y estudia",
            "Estudia",
            "Jubliado",
            "Estatus Social Subjetivo",
            "Percepci&oacuten meritocr&aacutetica",
            "Preferencia meritocr&aacutetica",
            "Percepci&oacuten no meritocr&aacutetica",
            "Preferencia no meritocr&aacutetica")
refm.ext1 <- list("<b>Educaci&oacuten (ref: Media completa o menos)<b>" = 3:5 ,
              "<b>Rango ingresos mensuales hogar (ref: $358.000 o menos )<b>"= 6:9,
              "<b>Actividad principal (ref: Trabajo jornada completa o parcial)<b>"=10:14)
semEXT <- texreg::htmlreg(modelos.ext1, center = TRUE,
                 custom.coef.names = coefm.ext1,
                 custom.model.names = c("Modelo 1","Modelo 2","Modelo 3","Modelo 4","Modelo 5"),
                 dcolumn = TRUE,
                 booktabs = TRUE,
                 use.packages = FALSE,
                 single.row = FALSE,digits = 3,
                 sideways = FALSE,
                 no.margin = FALSE,scalebox = 0.65,
                 caption.above = TRUE,
#                 custom.note = nota3,
                 float.pos = "H",
                 groups = refm.ext1,
                 label = "table:semREC",
#                 omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
                 caption = "Modelos de ecuaciones estructurales para variables independientes con la variable latente <b>Atribuciones externas (2)<b>")#, file='Output/models2.html')

```




# Análisis {#análisis}

## Análisis descriptivo

<div style="text-align: justify">


```{r tab-desc, echo=FALSE,results='hide'}
print(dfSummary(data, headings=FALSE, valid.col = FALSE, na.col = FALSE, varnumbers = FALSE,
                col.widths = c(170,  # variable
                              160,  # label
                              190, # stats/Values 
                              130, # freqs
                              130 # graph 
                              ),graph.magnif = 0.97),
      max.tbl.height = 800,
      method="render")
```

```{r atrib-desc, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = "Descriptivos univariados Atribuciones de pobreza y Atribuciones de riqueza"}
knitr::include_graphics(here::here("Output/images/atrib_likert.png"))
```

La Figura N° \@ref(fig:atrib-desc) presenta los estadísticos descriptivos de las variables dependientes. Las respuestas responden a la pregunta En su opinión, ¿con qué frecuencia las siguientes razones podrían ser la causa de la pobreza en Chile?, en donde las opciones van en una escala de "Nunca" a "Siempre". Al observar las respuestas para los cuatro indicadores que refieren a las atribuciones de pobreza, se da cuenta de distintas distribuciones entre ellas. En primer lugar, la explicación de las causas de la pobreza a partir de la Falta de habilidad muestra una gran concentración de respuestas en la categoría "A veces" (48,8%). Además, muestra una distribución similar a la distribución normal. En cuanto a la explicación de las causas de la pobreza a partir de la Mala suerte, existe una gran concentración en tres respuestas, siendo estas "Nunca", "Casi nunca" y (3) "A veces", con un mayor porcentaje para esta última (35,1%). En cuanto a las atribuciones de pobreza explicadas por la Falta de esfuerzo, la respuesta "A veces" agrupa la mayoría de los casos (41,9%), mostrando una distribución similar a la distribución normal. En este caso la suma de "Siempre" y "Casi siempre" (35.1%) es mayor que la suma de "Nunca" y "Casi nunca" (23%). En cuanto a la explicación de las causas de la pobreza a partir del Sistema económico y del Sistema educativo, en ambos indicadores se observa que la mayoría de los casos se concentran en las respuestas "Casi siempre" y "Siempre". Para el indicador de Sistema económico se tiene un 30,9% en "Casi siempre" y un 46,7% en "Siempre", lo cual al ser sumado da un total de 77.6% de las respuestas. Para la explicación de la pobreza por el Sistema educativo los porcentajes son de 36,9% en "Casi siempre" y 44,8% en "Siempre", lo cual al ser sumado da un total de 81.6%.

Respecto a las atribuciones de riqueza, se observa que la explicación de las causas de la riqueza a partir del Talento, Suerte y Trabajo duro se concentran en "A veces", con un 44,9%, 39% y 37,5%, respectivamente. Para los indicadores de Sistema económico y Sistema educativo la mayoría de los casos se agrupan en "Casi siempre" y "Siempre", siendo de un 29,4% y 47,8% para el primero, mientras que para el segundo de un 27,4% y 39,1%. 

Los descriptivos de los indicadores para las atribuciones de pobreza y riqueza muestran una tendencia clara, en donde las explicaciones por Falta de habilidad, Mala suerte y Falta de esfuerzo concentran las respuestas en "A veces". Sin embargo, se dan algunas diferencias, en donde la atribución de pobreza por Mala suerte presenta la mayoría de sus respuestas en "Casi nunca" y "Nunca", siendo la suma de estas más de la mitad de las respuestas. Por su parte, al contrastar las atribuciones de pobreza por Falta de habilidad y Falta de esfuerzo, ambas consideradas por la literatura como atribuciones internas, se observa que la última tiene una mayor concentración en "Casi siempre" y "Siempre" respecto de la primera. Lo anterior también se observa en las atribuciones de riqueza, en donde al comparar las explicaciones por Talento y Trabajo duro, se observa que la segunda concentra más respuestas en "Casi siempre" y "Siempre". En cuanto a las atribuciones por el Sistema económico y Sistema educativo, variables que en la literatura pertenecen al constructo de atribuciones externas, concentran la mayoría de sus respuestas en "Casi siempre" y "Siempre", lo cual muestra una tendencia a estar de acuerdo con explicar la pobreza a partir de factores externos de los individuos. Para el caso de las atribuciones de riqueza.

```{r merit-desc, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = "Descriptivos univariados Atribuciones de pobreza y Atribuciones de riqueza"}
knitr::include_graphics(here::here("Output/images/merit_likert.png"))
```

Por su parte, en la Figura N° \@ref(fig:merit-desc) se encuentran las variables independientes, distinguiéndose los cuatro indicadores para el grupo de percepciones meritocráticas, y cuatro para el grupo de preferencias meritocráticas. Para el caso de las percepciones, la tendencia en todos los indicadores muestra una gran concentración de respuestas en las categorías "De acuerdo" y "Totalmente de acuerdo", siendo levemente mayor para el caso de los indicadores no meritocráticos (Quienes tienen Padres ricos logran salir adelante y  Quienes tienen buenos contactos logran salir adelante). 

En cuanto a las preferencias, se observa un gran consenso en las preferencias meritocráticas a partir del Esfuerzo, es decir, en la afirmación de que Quienes más se esfuerzan deberían obtener mayores recompensas que quienes se esfuerzan menos. Dicho indicador cual acumula un 83% de sus respuestas en "De acuerdo" y "Totalmente de acuerdo". Las preferencias meritocráticas por el Talento también muestran una concentración en las respuestas "De acuerdo" y "Totalmente de acuerdo", siendo la suma de estas respuestas el 51.9% del total. Por su parte, las preferencias a partir de criterios no meritocráticos concentran más casos en las respuestas "En desacuerdo" y "Totalmente en desacuerdo". Más específicamente, la afirmación Está bien que quienes tienen padres ricos salgan adelante concentra un 37.8% de sus casos en estas respuestas, mientras que para Está bien que quienes tienen buenos contactos salgan adelante es de un 51.1%. 

## Modelo de medición para Atribuciones de pobreza y riqueza

### Modelos de correlación

<div style="text-align: justify">

En primer lugar, se realizaron los test de correlación policórica y de Pearson con los indicadores de atribuciones de pobreza y riqueza. A partir de la Figura N° \@ref(fig:matpolycor2) se presentan solamente los resultados de la correlación policórica. Tanto en las correlaciones de Pearson como en las correlaciones policóricas, es posible identificar un primer grupo a partir de correlaciones positivas de niveles medios y medios-altos, en donde se encuentran las Atribuciones de pobreza por Falta de habilidad, Atribuciones de pobreza por Falta de esfuerzo, Atribuciones de riqueza a partir del Talento y Atribuciones de riqueza a partir del Trabajo duro. Cada una de ellas correlaciona entre sí de manera positiva y con niveles medios-altos, en donde destacan los niveles de correlación entre los dos indicadores correspondientes a las atribuciones de pobreza (por Falta de habilidad y por Falta de esfuerzo), como también entre los dos indicadores de atribuciones de riqueza (por Talento y Trabajo duro). Por otro lado, se identifica otro grupo que correlaciona de manera positiva y con niveles medios y medios-altos entre Atribuciones de pobreza a partir del Sistema económico, Atribuciones de pobreza a partir del Sistema educativo, Atribuciones de riqueza a partir del Sistema económico y Atribuciones de riqueza a partir del Sistema educativo. Cabe destacar que los indicadores del primer grupo, coincidentes con lo que en la literatura se le ha llamado "atribuciones internas", correlacionan de manera negativa con los indicadores del segundo grupo, al cual se le puede denominar, a partir de la literatura, "atribuciones externas". Por último, las Atribuciones de pobreza por Mala suerte y Atribuciones de riqueza por Suerte, muestran una correlación positiva y media-alta solamente entre ellas, lo cual daría cuenta sobre un tercer constructo. Sin embargo, antes de anticiparnos a los constructos, es necesario realizar un análisis confirmatorio.

```{r matpolycor, echo=FALSE, fig.cap="Matriz de Correlaciones Policórica para Atribuciones de pobreza y riqueza", fig.align = 'center', out.width = '100%'}
polycor_atrib <- psych::polychoric(atribcor)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(polycor_atrib$rho) <-c(
  "(A) Atribuciones pobreza Falta habilidad",
  "(B) Atribuciones pobreza Mala suerte",
  "(C) Atribuciones pobreza Falta esfuerzo",
  "(D) Atribuciones pobreza Sistema económico",
  "(E) Atribuciones pobreza Sistema educativo",
  "(F) Atribuciones riqueza Talento",
  "(G) Atribuciones riqueza Suerte",
  "(H) Atribuciones riqueza Trabajo duro",
  "(I) Atribuciones riqueza Sistema económico",
  "(J) Atribuciones riqueza Sistema educativo"
  )
colnames(polycor_atrib$rho) <-c("(A)", "(B)","(C)","(D)","(E)", "(F)","(G)","(H)","(I)","(J)")
corrplot(polycor_atrib$rho,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  number.font = 6,
  tl.cex =0.75,
  number.cex = 1)
```

### Análisis factorial confirmatorio 

<div style="text-align: justify">

La implementación de CFA para las variables de atribuciones se debe principalmente a que se supone previamente el número de factores, como también su composición. Este método presenta la ventaja de que estima los errores de medición [@brown_confirmatory_2007]. Las investigaciones sobre atribuciones de pobreza y riqueza que utilizan indicadores en forma de escala likert, se identifican dos macro constructos latentes, siendo estas las atribuciones internas y las atribuciones externas. Debido a lo anterior, se estima un modelo de dos factores y se compara con modelos de más factores. 

En un primer momento, la estructura de dos factores incluyó indicadores fatalistas. En el modelo 1 las atribuciones internas están constituidas por los siguientes indicadores: (A) Atribución de pobreza por falta de habilidad, (B) Atribución de pobreza por mala suerte, (C) Atribución de pobreza por falta de esfuerzo, (F) Atribución de riqueza por talento, (G) Atribución de riqueza por suerte y (H) Atribución de riqueza por trabajo duro. Por su parte, las atribuciones externas están construidas a partir de (D) Atribución de pobreza por sistema económico, (E) Atribución de pobreza por sistema educativo y (I) Atribución de riqueza por sistema económico. El indicador de Atribución de riqueza por sistema educativo es excluido ya que la correlación entre errores era alta con casi todos los otros indicadores, independiente de su factor. Para mejorar el ajuste, se especificó una correlación entre los errores de los dos indicadores fatalistas, como también entre los indicadores de atribución de pobreza por falta de habilidad y atribución de pobreza por falta de esfuerzo. El modelo presentó medidas de ajuste de χ2 (24)=183.178, p<0.000, CFI=0.967, TLI=0.951, RMSEA=0.074. Si bien los ajustes en general son aceptables, indicadores como el RMSEA podrían mejorar. Además se realizaron diversos ajustes para modificar el modelo. Debido a lo anterior se compara con otros dos modelos con estructuras diferentes. 

El modelo 2 presenta una estructura de tres factores, siendo estos los de Atribuciones internas, Atribuciones externas y Atribuciones fatalistas. La composición de los factores fue para las Atribuciones internas: (A) Atribución de pobreza por falta de habilidad, (C) Atribución de pobreza por falta de esfuerzo, (F) Atribución de riqueza por talento y (H) Atribución de riqueza por trabajo duro. Las atribuciones externas se componen de los indicadores de (D) Atribución de pobreza por sistema económico, (E) Atribución de pobreza por sistema educativo y (I) Atribución de riqueza por sistema económico. El último factor referente a las Atribuciones fatalistas está construido en base a los indicadores de suerte, siendo estos (B) Atribución de pobreza por mala suerte y (G) Atribución de riqueza por suerte. Para el presente modelo fue excluido el indicador de Atribución de riqueza por sistema educativo, ya que presentó niveles altos de correlación entre errores. Además se especificó una correlación entre  los errores de los indicadores de Atribución de pobreza por falta de habilidad y Atribución de pobreza por falta de esfuerzo. El modelo presentó medidas de ajuste de χ2 (23)=132.216, p<0.000, CFI=0.978, TLI=0.965, RMSEA=0.062. El modelo presenta un mejor ajuste respecto del modelo 1, sin embargo, considerando que el factor de atribuciones fatalistas no es relevante para el presente estudio, se prueba un tercer modelo en donde no se incluyen los indicadores de suerte.

En el modelo 3 se generan dos factores excluyendo del análisis los indicadores de (B) Atribución de pobreza por mala suerte y (G) Atribución de riqueza por suerte. De esta forma, la composición de los dos factores son, para Atribuciones internas, a partir de los indicadores de (A) Atribución de pobreza por falta de habilidad, (C) Atribución de pobreza por falta de esfuerzo, (F) Atribución de riqueza por talento y (H) Atribución de riqueza por trabajo duro. Para el factor de Atribuciones externas, los indicadores que le corresponden son las (D) Atribución de pobreza por sistema económico, (E) Atribución de pobreza por sistema educativo y (I) Atribución de riqueza por sistema económico. Nuevamente, el presente modelo excluye el indicador de Atribución de riqueza por sistema educativo, ya que, en general, presenta correlación de errores altos con todos los otros indicadores. Además se especificó una correlación entre los errores de los indicadores de Atribución de pobreza por falta de habilidad y Atribución de pobreza por falta de esfuerzo. El modelo presentó medidas de ajuste de χ2 (12)=82.876	, p<0.000, CFI=0.984, TLI=0.971, RMSEA=0.069. 

Para mayor claridad, en la Tabla N° \@ref(tab:tab-fit) presentada más abajo se comparan las medidas de ajuste para los tres modelos de CFA.

```{r tab-fit,echo=FALSE, results='asis'}
sum_fit<- dplyr::bind_rows(fitmeasures(m2_4.fit)[c("chisq.scaled","df","cfi.scaled","rmsea","rmsea.scaled")],
                    fitmeasures(m3_3.fit)[c("chisq.scaled","df","cfi.scaled","rmsea","rmsea.scaled")],
                    fitmeasures(msf_3.fit)[c("chisq.scaled","df","cfi.scaled","rmsea","rmsea.scaled")])
sum_fit$mod <- c("Modelo 1","Modelo 2","Modelo 3")
sum_fit$est <- c("DWLS","DWLS","DWLS")
sum_fit <- dplyr::select(sum_fit,mod,est,everything())
colnames <- c("Modelo","Estimador","$\\chi^2$","df","CFI.sca","RMSEA","RMSEA.sca")

sumtable01<- kable(sum_fit,digits = 3,format = "html",row.names = F,booktabs=T, caption = "Summary fit indices",col.names = colnames,escape = FALSE) %>%
  kable_styling(full_width = F)  %>%
  collapse_rows(columns = 1,valign = "middle")  %>%
  footnote(number = c("Modelo 1: dos factores incluyendo atribuciones fatalistas",
                      "Modelo 2: tres factores: internas, externas y fatalistas",
                      "Modelo 3: dos factores excluyendo atribuciones fatalistas"));sumtable01
```

Debido a que las atribuciones fatalistas como constructo latente no es de relevancia para el presente estudio, y considerando que las medidas de ajuste son similares entre el Modelo 2 y 3, es que se propone el Modelo 3 como el modelo final, para luego tratar a los dos factores latentes de Atribuciones internas y Atribuciones externas como variable endógena en los modelos de ecuaciones estructurales. La construcción y las cargas factoriales del modelo se observan en la Figura  N° \@ref(fig:cfa-plot1). 

```{r cfa-plot1, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = "Clases latentes para atribuciones de pobreza y riqueza"}
knitr::include_graphics(here::here("Output/images/atrib_cfa_path.png"))
```

## Modelo de medición para Percepciones y Preferencias meritocráticas

### Modelos de correlación

<div style="text-align: justify">

Como primer paso para la construcción de las variables latentes para las creencias meritocráticas, se generan los modelos de correlación de pearson y correlación policórica. A continuación se muestran los resultados de la correlación policórica. En la Figura  N° \@ref(fig:matpolycor2) se observa que los valores medios-altos, es decir, correlaciones en torno al valor 0.5, se dan entre (A) [se] Obtienen mayores recompensas [por el] Esfuerzo y (B) [se] Obtienen mayores recompensas [por el] Talento, entre (C) Logran a salir adelante [quienes tienen] Padres ricos y (D) Logran a salir adelante [quienes tienen] buenos contactos, entre (E)[se]  Deberían obtener mayores recompensas [por el] Esfuerzo y (F) [se] Deberían tener mayores recompensas [por el] Talento y, finalmente, también se da entre (G) Está bien que salgan adelante [quienes tienen] Padres ricos (H) Está bien que salgan adelante [quienes tienen] Buenos contactos. La categorización que se logra distinguir a partir del modelo de correlación coincide con la literatura en cuanto a la existencia de cuatro sub-grupos y que las variables meritocráticas no son necesariamente opuestas a las no meritocráticas [@Castillo2020] al no existir grandes niveles de correlación negativa e incluso presentando ciertos niveles de correlación entre indicadores meritocráticos y no meritocráticos. Debido a los resultados que se obtuvieron a partir de los modelos de correlación, y considerando que la literatura apunta en la dirección de cuatro variables latentes, siendo estas de percepción meritocrática, preferencia merticorática, percepción no meritocrática y preferencia no meritocrática [@castillo_meritocracia_2019a; @Castillo2020; @Iturra2019] es que se procede a realizar un Análisis Factorial Confirmatorio (CFA) para poner a prueba la viabilidad de las cuatro variables latentes. 

```{r matpolycor2, echo=FALSE, fig.cap="Matriz de Correlaciones Policórica para Percepciones y Preferencias meritocráticas", fig.align = 'center', out.width = '100%'}
# Correlación Policórica 

polycor_merit <- psych::polychoric(meritcor)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(polycor_merit$rho) <-c(
  "(A) Obtienen mayores recompensas: Esfuerzo",
  "(B) Obtienen mayores recompensas: Talento",
  "(C) Logran salir adelante: Padres ricos",
  "(D) Logran salir adelante: Buenos contactos",
  "(E) Deberían obtener mayores recompensas: Esfuerzo",
  "(F) Deberían obtener mayores recompensas: Talento",
  "(G) Esta bien que salgan adelante: Padres ricos",
  "(H) Esta bien que salgan adelante: Buenos contactos")
colnames(polycor_merit$rho) <-c("(A)", "(B)","(C)","(D)","(E)", "(F)","(G)","(H)")
corrplot(polycor_merit$rho,
         method = "color",
         type = "upper",
         tl.col = "black",
         addCoef.col = "black",
         diag = TRUE,
         number.font = 6,
         tl.cex =0.75,
         number.cex = 1)

```

### Análisis Factorial Confirmatorio

<div style="text-align: justify">

Para la variable independiente sobre creencias meritocráticas se propone un modelo de cuatro factores, en donde los factores que corresponden a las creencias meritocráticas son el de percepción meritocrática y de preferencia meritocrática. Los otros dos factores corresponden a creencias no meritocráticas, siendo estos los de percepción no meritocrática y preferencia no meritocrática. En la Figura  N° \@ref(fig:cfa-plot2) se muestra a partir de qué indicadores se componen cada factor, como también las cargas factoriales. La percepción meritocrática incluye los indicadores de (A) [se] Obtienen mayores recompensas [por el] Esfuerzo y (B) [se] Obtienen mayores recompensas [por el] Talento: La preferencia meritocrática se compone de (E) [se] Deberían obtener mayores recompensas [por el] esfuerzo y (E) [se] Deberían obtener mayores recompensas [por el] talento. La percepción no meritocrática se compone de (C) Logran salir adelante [quienes tienen] padres ricos y (D) Logran salir adelante [quienes tienen] buenos contactos. Por último, la preferencia no meritocrática se compone de (G) Está bien que salgan adelante [quienes tienen] padres ricos y (H) Está bien que salgan adelante [quienes tienen] buenos contactos.  El modelo presentó medidas de ajuste de χ2 (28)=2386.315, p<, CFI=0.944, TLI=.887, RMSEA=0.088 [^1].


```{r cfa-plot2, echo=FALSE, fig.align = 'center', out.width = '100%', fig.cap = "Clases latentes para creencias meritocráticas y no meritocráticas"}
knitr::include_graphics(here::here("Output/images/merit_cfa_path.png"))
```


## Análisis de Modelos Estructurales

<div style="text-align: justify">

En esta sección se presentan los resultados de los modelos de ecuaciones estructurales, a partir del análisis de diferentes modelos de regresión. Para mayor claridad, se subdivide en dos apartados. En el primero se analiza la influencia de las variables exógenas sobre la variable latente referente a atribuciones internas de la pobreza y la riqueza. En el segundo se analiza la influencia de las variables exógenas sobre la variable latente referente a atribuciones externas de la pobreza y la riqueza. 

En un primer momento se analizan las variables de interés racional y sociodemográficas, considerando que son los factores que más se han incluido en la literatura para estudiar la variación en las atribuciones de pobreza y riqueza. Luego se incluyen las variables independientes, siendo estas las percepciones y preferencias meritocráticas. Finalmente, a modo de control, se agregan percepciones y preferencias no meritocráticas, las cuales refieren a la percepción de que quienes tienen padres ricos o buenos contactos logran salir adelante, o a la preferencia de que quienes tienen padres ricos o buenos contactos salgan adelante.

El orden en que se presentarán los resultados responde a un problema de relevancia en el área de las atribuciones de pobreza y riqueza, siendo las atribuciones internas un tipo de explicación que ha sido relacionado con la legitimación de desigualdades, mientras que las externas se vinculan más a una visión crítica.


### Atribuciones internas de pobreza y riqueza

<div style="text-align: justify">

Los modelos de la Tabla N° [4.2](#tab:tab-sem) muestra los resultados del modelo de regresión con las atribuciones internas como variable dependiente. Las variables independientes corresponden a los cuatro factores sobre creencias meritocráticas y no meritocráticas, como también a las variables de control.

Respecto a las variables de interés racional, no se observan coeficientes significativos tanto en educación como en rango de ingresos. Si se es sumamente flexible con la significancia, se observa que, con un 95% de confianza, el rango de ingresos mensuales de 1 millón a 2 millones de pesos presenta un coeficiente negativo, lo cual indicaría que este grupo, respecto de quienes pertenecen al tramo de $380.000 o menos, mantienen menos atribuciones internas sobre la pobreza y la riqueza.

A diferencia de las variables referentes a estratificación social, las variables sociodemográficas mostraron resultados más sólidos en cuanto a significancia. En los modelos 1, 3 y 5 se observa que la variable sexo, con hombre como categoría de referencia, presenta un coeficiente negativo a un 99% de confianza, lo que indica que las mujeres mantienen menos atribuciones internas que los hombres. Esto coincide con lo planteado por la tesis de los desvalidos que se observa en algunos trabajos, en donde las mujeres al verse en una situación de desventaja mantienen explicaciones externas, mientras que los hombres mantienen explicaciones internas para legitimar su propia posición. Por su parte, edad presenta un efecto positivo al 99,9% de confianza, lo cual indica que al aumentar la edad, aumentan las atribuciones internas. Finalmente, en actividad principal no se observan efectos significativos, a excepción de la de estudiante, que muestra un efecto negativo pero débil en significancia (95% de confianza), lo que indicaría que aquellos que se encuentran estudiando mantienen menos atribuciones internas respecto de aquellos que se encuentran trabajando con jornada completa o parcial. 

En el modelo 2, además de las variables de estratificación y estatus objetivo, se agrega el estatus social subjetivo del sujeto. El estatus social subjetivo muestra un efecto positivo y significativo al 99,9% de confianza, indicando que aquellos que se ubican a sí mismos más arriba en la sociedad mantienen más atribuciones internas. *buscar explicación*. Además, al agregar el indicador de estatus social subjetivo aumenta la significancia en la actividad princial de estudiante a un 99% de confianza. 

En el modelo 3 se observa únicamente el efecto de las percepciones y preferencias meritocráticas sobre las atribuciones internas. Para el caso de las percepciones, este presenta un efecto alto y positivo a un 99,9% de confianza, lo cual indicaría que a medida que se percibe más meritocracia, mayores serán las atribuciones internas. Por su parte, las preferencias meritocráticas presentan un efecto negativo a un 99,9% de confianza, es decir, a mayor preferencia por la meritocracia, menos atribuciones internas. En el modelo 4 se observan los efectos de las creencias meritocráticas controladas por creencias no meritocráticas, en donde las percepciones meritocráticas mantienen la significancia y el sentido del efecto, pero disminuye la magnitud del efecto, mientras que para las preferencias cambia el sentido del efecto, disminuye su magnitud y pierde toda significancia. 

El modelo 5 incluye las variables de creencias meritocráticas junto a todos los otros indicadores analizados anteriormente a modo de control. Tanto en percepciones y preferencias meritocráticas se mantienen los valores relativamente estables respecto del modelo 5, lo cual indicaría que su efecto se ve afectado al agregar variables de percepciones y preferencias no meritocráticas. En cuanto a las percepciones no meritocráticas, muestran un efecto negativo y significativo sobre las atribuciones internas, mientras que las preferencias no meritocráticas muestran un efecto positivo y significativo sobre las atribuciones internas.

<left><p id='tab:tab-sem'> Tabla 4.2 </p></left>
```{r tab-sem, echo=FALSE, results='asis'}
htmltools::HTML(semINT)
```

Los resultados que más llaman la atención son: (1) las medidas de estatus objetivo, como son el ingreso y la educación, no produce diferencias en las atribuciones internas; (2) el estatus social subjetivo si produce diferencias en las atribuciones internas, en donde a mayor estatus subjetivo, más atribuciones internas; (3) las variables de sexo y edad tienen efectos en la variación de las atribuciones internas, en donde las mujeres mantienen menos atribuciones internas que los hombres, y mientras más edad, mayores son las atribuciones internas. En cuanto a la actividad principal, (4) aquellos que están estudiando mantienen menos atribuciones internas respecto de aquellos que trabajan. Esto dialoga con la variable edad y apuntan a que los jóvenes mantienen menos atribuciones internas. (5) Las percepciones meritocráticas son la variable que más influencia tiene sobre las atribuciones internas, en donde a mayor percepción meritocrática, más atribuciones internas, mientras que (6) las preferencias meritocráticas no tienen efecto sobre las atribuciones internas. Por último, (7) las creencias no meritocráticas influyen en las atribuciones internas, en donde a mayor percepción no meritocrática, menos atribuciones internas, y a más preferencia no meritocrática mayores serán las atribuciones internas.

Los resultados se muestran a favor de la hipótesis central de la investigación, es decir, que las atribuciones de pobreza y riqueza se explican parcialmente por las creencias meritocráticas. Por su parte, La hipótesis específica 1, de que a mayor percepción meritocrática mayor atribuciones internas hacia la pobreza y la riqueza, se cumple. Tal como se esperaba, mayores niveles en la percepción de meritocracia presenta un efecto positivo con las atribuciones internas de pobreza y riqueza, β 0.443***.

### Atribuciones externas de pobreza y riqueza

<div style="text-align: justify">

Los modelos de la Tabla N° [4.3](#tab:tab-sem2) muestra los resultados del modelo de regresión, en donde la variable dependiente son las atribuciones externas y las variables independientes corresponden a los cuatro factores sobre creencias meritocráticas y no meritocráticas.

Al igual que con las atribuciones internas de pobreza y riqueza, en las atribuciones externas no se observan efectos significativos por parte de variables de estartificación, en este caso los indicadores de ingreso y educación. En este sentido, se descarta la hipótesis de interés racional tanto para las atribuciones internas como externas. En cuanto a las variables sociodemográficas, sexo presenta un efecto positivo y significativo al 99% de confianza. Esto quiere decir que las mujeres, en comparación de los hombres, mantienen más atribuciones externas. Este resultado dialoga con los resultados del apartado anterior, en donde se observa que las mujeres mantienen menos atribuciones internas que los hombres. Lo anterior indica una visión más crítica por parte de las mujeres, en cuanto explican las causas de la pobreza y la riqueza a partir de factores externos a los individuos y, si se quiere, desde las estructuras sociales. 

El estatus social subjetivo aparece nuevamente como un factor influyente en las atribuciones, aunque esta vez con una significancia al 99% de confianza. Los resultados muestran un efecto bajo y negativo sobre las atribuciones externas, lo que indica que el posicionarte a ti mismo más arriba en la escala de estatus subjetivo tiene como efecto mantener menos atribuciones externas. Los resultados sobre el efecto del estatus social subjetivo sobre atribuciones externas va en la misma dirección que el efecto de esta variable sobre las atribuciones internas, lo cual muestra que la autopercepción de la posición social tiene un efecto en las atribuciones, en donde mientras más arriba te ubicas a ti mismo, más culpabilizas a los individuos de su propia situación, como también explicas en menor medida las causas de la pobreza y la riqueza a partir de factores externos.

En los modelos 3 y 4 se observan resultados peculiares. En el modelo 3 se observan efectos altos y significativos al 99,9% tanto en percepciones meritocráticas como en preferencias meritocráticas. Para el caso de las percepciones meritocráticas, el efecto es negativo, lo cual se traduce en que mientras percibas más mecanismos meritocráticos funcionando en la sociedad, mantienes menos atribuciones externas. Por su parte, el efecto de las preferencias meritocráticas es positivo, es decir, en cuanto más se prefiera la meritocrácia, más atribuciones externas. Sin embargo, el modelo 4 nos muestra que, al ingresar las variables de percepciones no meritocráticas y preferencias no meritocráticas en la regresión, el efecto de las percepciones y preferencias meritocráticas disminuye a casi cero y pierde toda significancia, mientras que el efecto de las variables no meritocráticas son significativas a un 99,9% de confianza. El modelo 4 nos muestra entonces que cuando se perciben más mecanismos no meritocráticos en la sociedad, más se explican las causas de la pobreza y la riqueza a partir de factores externos. Por su parte, mientras más se prefieran o validen mecanismos no meritocráticos para salir adelante en la sociedad, menores serán las atribuciones externas para la pobreza y la riqueza.

Por último, en el modelo 5, el cual incluye todas las variables independientes y de control, se mantienen relativamente estables los coeficientes y significancias descritos en los modelos anteriores, lo cual indicaría que no existe una alta covarianza entre las variables exógenas. 

<left><p id='tab:tab-sem2'> Table 4.3 </p></left>
```{r tab-sem2, echo=FALSE, results='asis'}
htmltools::HTML(semEXT)
```

De este modelo se destacan los siguientes puntos: (1) las variables de estatus subjetivo, es decir, ingreso y educación, no producen diferencias en las atribuciones externas, mientras que (2) el estatus social subjetivo tiene un efecto negativo sobre las atribuciones externas; (3) de las variables sociodemográficas, la edad no produce diferencias en las atribuciones externas, mientras que sexo sí, en donde las mujeres mantienen más atribuciones externas que los hombres. (4) La actividad principal no presenta efectos sobre las atribuciones externas. (5) En el modelo en que se incluyen solamente variables de creencias meritocráticas, se observa un efecto de las percepciones y preferencias meritocráticas sobre atribuciones externas. Sin embargo, al incluir variables de creencias no meritocráticas, el efecto desaparece. En este sentido, (6) se observa un efecto positivo en las percepciones no meritocráticas sobre las atribuciones externas, y un efecto negativo de las preferencias no meritocráticas sobre las atribuciones externas.

En este caso, tanto la hipótesis general como la hipótesis específica 2, de que a mayor percepción meritocrática, menores serán las atribuciones externas, no se cumplen. Si bien en un principio tanto las percepciones como preferencias meritocráticas muestran un efecto grande y significativo al 99,9%, al ser controlado por variables de creencias no meritocráticas el efecto desaparece. En este sentido, al momento de analizar qué afecta en la variación de las atribuciones externas o estructuralistas, la percepción y preferencia de que se salga adelante a partir de factores adscriptivos o de origen parece ser un gran determinante.

[^1]: Los resultados del índice RMSEA traspasan el límite aceptable para un modelo con buen ajuste (≤ 0,06), e incluso es mayor a límites más flexibles (≤ 0,07 / 0,08). Sin embargo, dentro de las posibilidades de variables latentes que coincidan con la literatura, es el mejor modelo en términos de coherencia y ajustes.
